---
title: "Cleaning HCWS"
output: html_notebook
---

```{r include=FALSE}
library(tidyverse)
library(magrittr)
library(gtsummary)
library(flextable)


hcws <- read_rds("hcws 23mar2022")
```

# Check the gender
```{r}
table(hcws$d_gender, useNA = "always") %>% 
  as.data.frame() %>% 
  set_colnames(c("Gender", "Freq")) %>% 
  flextable()
```

```{r}
hist(hcws$d_age_i, main = "Histogram of age", xlab = "Ages")
```
## Display the age in descending order and identify the extreme and improbable values
Ages less than 18 and more than 75
```{r}
hcws %>% 
  filter(d_age_i < 18 | d_age_i > 75) %>% 
  select(ID = ctry_id, Country = country, Age = d_age_i) %>% 
  arrange(Age) %>% 
  pander()
```
Set such ages to the median age.

Any suggestion?

```{r age-correction, include=FALSE}
med <- median(hcws$d_age_i, na.rm = T)
hcws <- hcws %>% 
  mutate(
    d_age_i = case_when(d_age_i <18 | d_age_i > 75 ~ med, T ~ d_age_i) %>% as.integer()
  )
```

See the effect of the data cleaning
```{r}
hist(hcws$d_age_i, xlab = "Age", main = "Histogram of age")
```
Look more of age distribution of healthcare workers to me

## Marital status
Use the new marital status grouping
```{r}
hcws %>% 
  select(marital, d_marital_c_u) %>% 
  mutate(marital = fct_explicit_na(marital)) %>% 
  tbl_summary(by = marital, statistic = everything() ~ "{n}")
```

```{r}
hces %>% 
  select(education) %>% 
```

The levels targeted for removal. Their entries are suspicious
```{r}
hcws %>% 
  filter(education == "Remove?") %>% 
  select(ID = ctry_id, Country = country, Education = d_edu_c_o, Other = educ_other, Profession = d_job_role_c_u, Type = d_job_type_c_u)
```


### Suggestion
Rename `Undergraduate` correctly as graduate, then all others under it as undergraduate.


## Number of children
Different countries used different scales. As such, it has to be combined as one. The new groupings are seen below
```{r}
hcws %$% table(children) %>% 
  pander()
```

## Hospitals
```{r}
hcws %$% 
  table(hospital, country) %>% 
  pander()
```

Senegal classified the hospital as Level 1 to 3. It would be easier (and best in my opinion) to arrange the hospitals as such.

## Job roles
```{r}
hcws %$% 
  table(job_role) %>% 
  pander()
```
The grouping above closely matches the stated job role or as indicated in the "other". We cal combine all others as 1, possible removing responses from students.


